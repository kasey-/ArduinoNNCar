#include "Tinn.h"
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

int main() {
    float in[20][6] = {
        /* Normal drive */
        { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 },
        { 1.0, 0.0, 0.0, 0.0, 0.0, 0.0 },
        { 0.0, 1.0, 0.0, 0.0, 0.0, 0.0 },
        { 0.0, 0.0, 1.0, 0.0, 0.0, 0.0 },
        { 0.0, 0.0, 0.0, 1.0, 0.0, 0.0 },

        /* Sensor stop */
        { 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 },
        { 1.0, 0.0, 0.0, 0.0, 1.0, 0.0 },
        { 0.0, 1.0, 0.0, 0.0, 1.0, 0.0 },
        { 0.0, 0.0, 1.0, 0.0, 1.0, 0.0 },
        { 0.0, 0.0, 0.0, 1.0, 1.0, 0.0 },

        { 0.0, 0.0, 0.0, 0.0, 0.0, 1.0 },
        { 1.0, 0.0, 0.0, 0.0, 0.0, 1.0 },
        { 0.0, 1.0, 0.0, 0.0, 0.0, 1.0 },
        { 0.0, 0.0, 1.0, 0.0, 0.0, 1.0 },
        { 0.0, 0.0, 0.0, 1.0, 0.0, 1.0 },

        { 0.0, 0.0, 0.0, 0.0, 1.0, 1.0 },
        { 1.0, 0.0, 0.0, 0.0, 1.0, 1.0 },
        { 0.0, 1.0, 0.0, 0.0, 1.0, 1.0 },
        { 0.0, 0.0, 1.0, 0.0, 1.0, 1.0 },
        { 0.0, 0.0, 0.0, 1.0, 1.0, 1.0 }
     };

    float tg[20][2] = {
        { 0.5, 0.5 },
        { 1.0, 1.0 },
        { 0.5, 1.0 },
        { 0.0, 0.0 },
        { 1.0, 0.5 },
        
        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.0, 0.0 },
        { 0.5, 0.5 },
        
        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.0, 0.0 },
        { 0.5, 0.5 },

        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.5, 0.5 },
        { 0.0, 0.0 },
        { 0.5, 0.5 }
    };

    /* Neural network */
    Tinn tinn = xtbuild(6, 7, 2);

    /* Train */
    float lr = 0.5;
    for(int i = 0; i < 5000; i++) {
        if(i > 1000 && lr > 0.0001)
            lr -= 0.0001;
        for(int l = 0; l < 20; l++)
            xttrain(tinn, in[l], tg[l], lr);
        //float error = xttrain(tinn, in, tg, 0.5);
        //printf("%.12f\n", error);
    }

    /* Display biases */
    for (int i = 0; i < tinn.nb; i++)
        printf("%f, ", tinn.b[i]);
    printf("\n----------------\n");

    /* Display weights */
    for (int i = 0; i < tinn.nw; i++)
        printf("%f, ", tinn.w[i]);
    printf("\n----------------\n");

    printf("%f\n", xtpredict(tinn,in[19])[0]);
    printf("%f\n", xtpredict(tinn,in[19])[1]);

    return 0;
}
